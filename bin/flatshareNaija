#!/usr/bin/env zsh
set -euo pipefail
APP_ROOT="${0:a:h:h}"
source "$APP_ROOT/lib/common.zsh"

cmd="${1:-help}"; shift || true

case "$cmd" in
  init)
    require_sqlite
    mkdir -p "$APP_ROOT/db"
    sqlite3 "$APP_ROOT/db/flatshare.db" < "$APP_ROOT/db/migrations/001_init.sql"
    log_ok "Database initialized"
    ;;
  user)    exec "$APP_ROOT/bin/fsn-user" "$@" ;;
  pref)    exec "$APP_ROOT/bin/fsn-pref" "$@" ;;
  listing) exec "$APP_ROOT/bin/fsn-listing" "$@" ;;
  match)   exec "$APP_ROOT/bin/fsn-match" "$@" ;;
  search)  exec "$APP_ROOT/bin/fsn-search" "$@" ;;
  export)  exec "$APP_ROOT/bin/fsn-export" "$@" ;;
  seed)    exec "$APP_ROOT/bin/fsn-seed" "$@" ;;
  help|*)
    cat <<'USAGE'
FlatshareNaija CLI

Usage:
  flatshareNaija init
  flatshareNaija user add <name> <email> <phone> <city>
  flatshareNaija pref set <user> <budget> <city> <area> <lifestyle>
  flatshareNaija listing add <title> <desc> <city> <area> <rent>
  flatshareNaija listing search <city> <area> <max>
  flatshareNaija match <user>
  flatshareNaija search "<natural language query>"
  flatshareNaija export [csv|json]
  flatshareNaija seed
USAGE
    ;;
esac
