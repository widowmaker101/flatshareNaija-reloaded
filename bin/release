#!/usr/bin/env zsh
set -euo pipefail
version="${1:-}"
[[ -z "$version" ]] && { echo "Usage: release <version>"; exit 1; }

echo "ðŸš€ Preparing release $version..."
to_stage=(bin lib db README.md LICENSE .gitignore .github/workflows/ci.yml)
existing=()
for p in "${to_stage[@]}"; do [[ -e "$p" ]] && existing+=("$p"); done

git add "${existing[@]}"
git commit -m "Release $version" || echo "No changes to commit"
git tag -f "$version"
git push origin main
git push -f origin "$version"
echo "âœ… Release $version pushed"
