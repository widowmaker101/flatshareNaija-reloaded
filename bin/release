#!/usr/bin/env zsh
set -euo pipefail
version="${1:-}"
[[ -z "$version" ]] && { echo "Usage: release <version>"; exit 1; }

echo "ðŸš€ Preparing release $version..."
# Stage only existing files to avoid pathspec errors
to_stage=()
for p in bin lib db README.md LICENSE .gitignore .github/workflows/ci.yml; do
  [[ -e "$p" ]] && to_stage+=("$p")
done

git add "${to_stage[@]}"
git commit -m "Release $version" || echo "No changes to commit"
git tag -f "$version"
git push origin main
git push -f origin "$version"
echo "âœ… Release $version pushed"
