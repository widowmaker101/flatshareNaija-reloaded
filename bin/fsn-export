#!/usr/bin/env zsh
set -euo pipefail
APP_ROOT="${0:a:h:h}"
source "$APP_ROOT/lib/common.zsh"
require_sqlite

fmt="${1:-csv}"
case "$fmt" in
  csv)
    sqlite3 "$FSN_DB" -header -csv "SELECT id,title,city,area,rent,has_generator,has_inverter,created_at FROM listings;"
    ;;
  json)
    require_jq
    sqlite3 "$FSN_DB" -json "SELECT id,title,city,area,rent,has_generator,has_inverter,created_at FROM listings;" | jq .
    ;;
  *)
    log_err "Unknown format: $fmt (use csv|json)"; exit 1 ;;
esac
